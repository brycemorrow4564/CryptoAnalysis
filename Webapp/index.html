<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <title>Crypto Analysis Application</title>
    <link rel="stylesheet" href="styles.css"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highstock/5.0.12/highstock.js"></script>
    <script id="sap-ui-bootstrap"
            src="https://sapui5.hana.ondemand.com/resources/sap-ui-core.js"
            data-sap-ui-theme="sap_belize"
            data-sap-ui-libs="sap.m"
            data-sap-ui-language="en"
            data-sap-ui-bindingSyntax="complex"
            data-sap-ui-compatVersion="edge"
            data-sap-ui-preload="async"
            data-sap-ui-resourceroots='{"sap.crypto.app": "."}'></script>
    <script>

        sap.ui.getCore().attachInit(() => {

            //Used to access global ids for specific models
            $.sap.require("sap.crypto.app.Utility.Globals");

            //Initialize App as soon as we have loaded in all components

            new sap.ui.core.ComponentContainer({
                propagateModel: true,
                name : "sap.crypto.app"
            }).placeAt("content");

            //Data formats for models and model setup
            var core            = sap.ui.getCore(),
                dataModeData    =
                    {
                        'active': 'MarketCap',
                        'modes': [
                            {'name': 'MarketCap'},
                            {'name': 'Volume'},
                            {'name': 'Open'},
                            {'name': 'Close'},
                            {'name': 'High'},
                            {'name': 'Low'}
                        ]
                    },
                coinToChartData =
                    {
                        "columns": []
                    },
                correlationMatrixData =
                    {
                        "columns": []
                    },
                aggCoinData     =
                    {
                        "Coins" : []
                    },
                logModeData     =
                    {
                        "active": false,
                        "options": [{"option": true},
                                    {"option": false}]
                    },
                subredditData   =
                    {
                      "subreddits": []
                    };

            const logModeModel      = new sap.ui.model.json.JSONModel(logModeData);
            const dataModeModel     = new sap.ui.model.json.JSONModel(dataModeData);
            const coinToChartModel  = new sap.ui.model.json.JSONModel(coinToChartData);
            const aggCoinModel      = new sap.ui.model.json.JSONModel(aggCoinData);
            const corrMatrixModel   = new sap.ui.model.json.JSONModel(correlationMatrixData);
            const subredditModel    = new sap.ui.model.json.JSONModel(subredditData);

            core.setModel(logModeModel, GLOBALS.logifyModelId);
            core.setModel(dataModeModel, GLOBALS.dataModeModelId);
            core.setModel(coinToChartModel, GLOBALS.coinChartModelId);
            core.setModel(aggCoinModel, GLOBALS.aggCoinModelId);
            core.setModel(corrMatrixModel, GLOBALS.correlationMatrixModelId);
            core.setModel(subredditModel, GLOBALS.subredditModelId);

            //Bring in coin data to model once server responds
            $.ajax({
                url: '/coin_names/',
                success: function(response) {
                    var coin_objs = [];
                    response['coin_names'].forEach(function(coinObj) {
                        coin_objs.push({
                            'name': coinObj['coin_name'],
                            'data': [] //all coins start with empty data field and we load in as requested by user
                        });
                    });
                    aggCoinModel.setData({"Coins": coin_objs});
                    aggCoinModel.refresh(true);
                }
            });

            //Bring in subreddit names
            $.ajax({
                url: '/subreddit_names/',
                success: function(response) {
                    var data = response['subreddit_names'];
                    subredditModel.setData({"subreddits": data});
                    subredditModel.refresh(true);
                }
            });

        });

    </script>
</head>
<body class="sapUiBody" id="content">
</body>
</html>