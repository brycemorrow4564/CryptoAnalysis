<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <title>Crypto Analysis</title>
    <link rel="stylesheet" href="styles.css"/>
    <script src="//code.jquery.com/jquery-1.10.2.js"></script>
    <script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
    <script src="./Highstock-5.0.12/code/highstock.js"></script>
    <script id="sap-ui-bootstrap"
            src="../resources/sap-ui-core.js"
            data-sap-ui-theme="sap_belize"
            data-sap-ui-libs="sap.m"
            data-sap-ui-bindingSyntax="complex"
            data-sap-ui-compatVersion="edge"
            data-sap-ui-preload="async"
            data-sap-ui-resourceroots='{
            "sap.crypto.app": "."}'></script>
    <script>
        $.sap.require('sap.ui.thirdparty.jqueryui.jquery-ui-core');
        $.sap.require('sap.ui.thirdparty.jqueryui.jquery-ui-widget');
        $.sap.require('sap.ui.thirdparty.jqueryui.jquery-ui-mouse');
        $.sap.require('sap.ui.thirdparty.jqueryui.jquery-ui-sortable');
        $.sap.require('sap.ui.thirdparty.jqueryui.jquery-ui-droppable');
        $.sap.require('sap.ui.thirdparty.jqueryui.jquery-ui-draggable');

        $.sap.require('sap.crypto.app.Utility.ComponentGlobals');
        $.sap.require('sap.crypto.app.Utility.Globals');

        //Initialize App
        sap.ui.getCore().attachInit(function () {
            new sap.ui.core.ComponentContainer({
                propagateModel: true,
                name : "sap.crypto.app"
            }).placeAt("content");
        });

        //Setup some initial data
        var dataModesObj = {
                'active': 'MarketCap',     //Current data mode
                'modes': [                  //All possible data modes
                    {'name': 'MarketCap'},
                    {'name': 'Volume'},
                    {'name': 'Daily Price'}
                ]
            },
            coinToChartData = {
                "columns": []
            },
            core = sap.ui.getCore();

        var agg_data = {"Coins" : []},
            success  = false;

        $.ajax({
            async: false,
            url: 'https://tranquil-bastion-27755.herokuapp.com/coins/',
            success: function(response) {
                success = true;
                agg_data = response;
                agg_data['Coins'].forEach(function(coinObj) {
                    coinObj['data'].forEach(function(elem) {
                        elem['Volume'] = parseInt(elem['Volume'].replace(/,/g,''));
                        elem['MarketCap'] = parseInt(elem['MarketCap'].replace(/,/g,''));
                        elem['Open'] = parseFloat(elem['Open'].replace(/,/g,''));
                    });
                });
                core.setModel(new COMPONENT.JSONModel(agg_data), GLOBALS.aggCoinModelId);
            }
        });

        if (!success) {
            core.setModel(new COMPONENT.JSONModel(agg_data), GLOBALS.aggCoinModelId);
        }

        core.setModel(new COMPONENT.JSONModel(dataModesObj), GLOBALS.dataModeModelId);
        core.setModel(new COMPONENT.JSONModel(coinToChartData), GLOBALS.coinChartModelId);
    </script>
</head>
<body class="sapUiBody" id="content">
</body>
</html>

<!--

                for (var i = 0; i < agg_data['Coins'].length; i++) {
                    coinObj = agg_data['Coins'][i];
                    for (var x = 0; x < coinObj['data']; x++) {
                        var elem = coinObj['data'][x];
                        agg_data['Coins'][i]['data'][x]['Volume'] = parseInt(elem['Volume'].replace(/,/g,''));
                        agg_data['Coins'][i]['data'][x]['MarketCap'] = parseInt(elem['MarketCap'].replace(/,/g,''));
                        agg_data['Coins'][i]['data'][x]['Open'] = parseFloat(elem['Open'].replace(/,/g,''));
                    }
                }
                agg_data = response;

-->