<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <title>Crypto Analysis</title>
    <link rel="stylesheet" href="styles.css"/>
    <script id="sap-ui-bootstrap"
            src="./resources/sap-ui-core.js"
            data-sap-ui-theme="sap_belize"
            data-sap-ui-libs="sap.m"
            data-sap-ui-bindingSyntax="complex"
            data-sap-ui-compatVersion="edge"
            data-sap-ui-preload="async"
            data-sap-ui-resourceroots='{
            "sap.crypto.app": "."}'>
    </script>
    <script>

        //TODO HIGH IMPORTANCE
        //Get rid of the component globals file and only load in components when necessary

        jqueryLibs = ['sap.ui.thirdparty.jqueryui.jquery-ui-core',
                      'sap.ui.thirdparty.jqueryui.jquery-ui-widget',
                      'sap.ui.thirdparty.jqueryui.jquery-ui-mouse',
                      'sap.ui.thirdparty.jqueryui.jquery-ui-droppable',
                      'sap.ui.thirdparty.jqueryui.jquery-ui-draggable';

        sap.ui.require(jqueryLibs, function() {
            //empty callback since we don't need these modules right away
        });

        //Initialize App
        sap.ui.getCore().attachInit(function () {
            new sap.ui.core.ComponentContainer({
                propagateModel: true,
                name : "sap.crypto.app"
            }).placeAt("content");
        });

        $.sap.require("sap.crypto.app.Utility.ComponentGlobals");
        $.sap.require("sap.crypto.app.Utility.Globals");

        //Setup some initial data
        var dataModesObj = {
                'active': 'MarketCap',      //Current data mode
                'modes': [                  //All possible data modes
                    {'name': 'MarketCap'},
                    {'name': 'Volume'},
                    {'name': 'Daily Price'}
                ]
            },
            coinToChartData = {
                "columns": []
            },
            core = sap.ui.getCore();

        var agg_data = {"Coins" : []},
            success  = false;

        $.ajax({
            async: false,
            url: '/coins/',
            success: function(response) {
                success = true;
                agg_data = response;
                agg_data['Coins'].forEach(function(coinObj) {
                    coinObj['data'].forEach(function(elem) {
                        elem['Volume'] = parseInt(elem['Volume'].replace(/,/g,''));
                        elem['MarketCap'] = parseInt(elem['MarketCap'].replace(/,/g,''));
                        elem['Open'] = parseFloat(elem['Open'].replace(/,/g,''));
                    });
                });
                core.setModel(new COMPONENT.JSONModel(agg_data), GLOBALS.aggCoinModelId);
            }
        });

        if (!success) {
            core.setModel(new COMPONENT.JSONModel(agg_data), GLOBALS.aggCoinModelId);
        }

        core.setModel(new COMPONENT.JSONModel(dataModesObj), GLOBALS.dataModeModelId);
        core.setModel(new COMPONENT.JSONModel(coinToChartData), GLOBALS.coinChartModelId);
    </script>
</head>
<body class="sapUiBody" id="content">
    <script src="//code.jquery.com/jquery-1.10.2.js"></script>
    <script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
    <script src="./Highstock-5.0.12/code/highstock.js"></script>
</body>
</html>