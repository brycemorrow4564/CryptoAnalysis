<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <title>Crypto Analysis</title>
    <link rel="stylesheet" href="styles.css"/>
    <script src="//code.jquery.com/jquery-1.10.2.js"></script>
    <script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
    <script src="./Highstock-5.0.12/code/highstock.js"></script>
    <script id="sap-ui-bootstrap"
            src="../resources/sap-ui-core.js"
            data-sap-ui-theme="sap_belize"
            data-sap-ui-libs="sap.m"
            data-sap-ui-bindingSyntax="complex"
            data-sap-ui-compatVersion="edge"
            data-sap-ui-preload="async"
            data-sap-ui-resourceroots='{
            "sap.crypto.app": "."}'></script>
    <script>
        $.sap.require('sap.ui.thirdparty.jqueryui.jquery-ui-core');
        $.sap.require('sap.ui.thirdparty.jqueryui.jquery-ui-widget');
        $.sap.require('sap.ui.thirdparty.jqueryui.jquery-ui-mouse');
        $.sap.require('sap.ui.thirdparty.jqueryui.jquery-ui-sortable');
        $.sap.require('sap.ui.thirdparty.jqueryui.jquery-ui-droppable');
        $.sap.require('sap.ui.thirdparty.jqueryui.jquery-ui-draggable');

        $.sap.require('sap.crypto.app.LocalJsonLoader'); //In WebApp dir due to ajax relative path call semantics
        $.sap.require('sap.crypto.app.Utility.ComponentGlobals');
        $.sap.require('sap.crypto.app.Utility.Globals');

        //Initialize App
        sap.ui.getCore().attachInit(function () {
            new sap.ui.core.ComponentContainer({
                propagateModel: true,
                name : "sap.crypto.app"
            }).placeAt("content");
        });

        //Setup some initial data
        var dataModesObj = {
                'active': 'MarketCap',     //Current data mode
                'modes': [                  //All possible data modes
                    {'name': 'MarketCap'},
                    {'name': 'Volume'},
                    {'name': 'Daily Price'}
                ]
            },
            coinToChartData = {
                "columns": []
            },
            core = sap.ui.getCore();

        var agg_data = {};
        $.ajax({
            async: false,
            url: 'http://localhost:8080/coins/',
            success: function(response) {
                agg_data = response;
                agg_data['Coins'].forEach(function(coinObj) {
                    coinObj['data'].forEach(function(elem) {
                        elem['Volume'] = parseInt(elem['Volume'].replace(/,/g,''));
                        elem['MarketCap'] = parseInt(elem['MarketCap'].replace(/,/g,''));
                        elem['Open'] = parseFloat(elem['Open'].replace(/,/g,''));
                    });
                });
                core.setModel(new COMPONENT.JSONModel(agg_data), GLOBALS.aggCoinModelId);
            }
        });

        core.setModel(new COMPONENT.JSONModel(dataModesObj), GLOBALS.dataModeModelId);
        core.setModel(new COMPONENT.JSONModel(coinToChartData), GLOBALS.coinChartModelId);
    </script>
</head>
<body class="sapUiBody" id="content">
</body>
</html>